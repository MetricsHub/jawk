# Jawk - AWK for Java

## Introduction

**Jawk** is _the_ implementation of AWK in Java. **Jawk** parses, analyzes, and interprets and/or compiles AWK scripts. Compilation is targetted for the JVM.

**Jawk** runs on any platform which supports, at minimum, Java 11.

## Usage

To use, simply download the application, copy the release jar to the jawk.jar file and execute the following command:

```shell-session
$ java -jar jawk-${project.version}-standalone.jar <command-line-arguments>
```

To view the command line argument usage summary, execute:

```shell-session
$ java -jar jawk-${project.version}-standalone.jar -?

Usage:
java -jar jawk-${project.version}-standalone.jar [-F fs_val] [-f script-filename] [-o output-filename] [-c] [-S] [-s] [-x] [-y] [-r] [--locale locale] [-ext] [-ni] [-t] [-v name=val]... [script] [name=val | input_filename]...

 -F fs_val = Use fs_val for FS.
 -f filename = Use contents of filename for script.
 -v name=val = Initial awk variable assignments.

 -t = (extension) Maintain array keys in sorted order.
 -c = (extension) Compile to intermediate file. (default: a.ai)
 -o = (extension) Specify output file.
 -S = (extension) Write the syntax tree to file. (default: syntax_tree.lst)
 -s = (extension) Write the intermediate code to file. (default: avm.lst)
 -x = (extension) Enable _sleep, _dump as keywords, and exec as a builtin func.
 -y = (extension) Enable _INTEGER, _DOUBLE, and _STRING casting keywords.
 -r = (extension) Do NOT hide IllegalFormatExceptions for [s]printf.
 --locale Locale = (extension) Specify a locale to be used instead of US-English
-ext= (extension) Enable user-defined extensions. (default: not enabled)
-ni = (extension) Do NOT process stdin or ARGC/V through input rules.
                  (Useful for blocking extensions.)

 -h or -? = (extension) This help screen.
```

**Jawk** supports all of the standard AWK command line parameters:

* `-v <name=value>` - global variable assignments prior to the execution of the script.
* `-F <fs>` - input field separator assignment. This is equivalent to `FS="fs"` prior to its use (by getline or by input rules).
* `-f <filename>` - The script filename. If used, a script argument is not expected.

To enhance development and script execution over traditional AWK, **Jawk** also supports the following command-line parameter extensions:

* `-t` - Maintain all associated arrays in key-sorted order. This is implemented by using a TreeMap instead of a HashMap as the backing store for the associated array.
* `-c` - writes the tuples (generated by the Intermediate Subsystem) to a file, and then halts. If the -o parameter is provided, use its optarg as the filename. Otherwise, write to `"a.ai"`. This file can be used as an argument to -f to avoid the front end and intermediate steps for a particular script. It also provides a measure of script obfuscation.
* `-o <filename>` - Override the default output filename for extended parameters -c, -S, -s, -z, and -Z.
* `-S` - Dump the abstract syntax tree (constructed by the front end) to a text readable file. If the -o argument is not provided, the contents will be dumped into the `syntax_tree.lst` file.
* `-s` - Dump the intermediate code (tuples) to a text readable file. If the -o argument is not provided, the contents will be dumped into the `"avm.lst"` file.
* `-x` - Enable `**_sleep**`, `**_dump**` and `**exec**` keywords. `_sleep` causes the execution thread to sleep for a specified number of seconds (or one second if no argument is provided), and `_dump` dumps the global variables (names and values) to stdout. If associative array arguments are provided, `_dump` dumps the contents of each associative array to stdout. And `exec` dynamically parses and executes complete AWK scripts, however in a separate vairable environment.
* `-y` - Enable `**_INTEGER**`, `**_DOUBLE**` and `**_STRING**` typecast keywords. These are particularly useful in \[s\]printf functions/statements to force parameters to convert to particular types.
* `-r` - Allow IllegalFormatExceptions to be thrown when using the java.util.Formatter class for printf/sprintf. If the argument is not provided, the interpreter/compiled result catches IllegalFormatExceptions and silently returns a blank string in its place. If the argument is provided, the interpreter/compiled result will halt by throwing this runtime exception.
* `-ext` - Enables the parser/AVM to recognize extensions within scripts. Extensions allow for arbitrary Java code to be called as registered AWK functions. Please refer to the [Jawk Extension Facility Description](extensions.html) page for more information.
* `-ni` - Conventionally used in conjunction with extensions, -ni prohibits Jawk from processing stdin or files in ARGC/V through action rules. This enables the extension facility to apply action rules to blockable events. Please refer to the [Jawk Extension Facility Description](extensions.php) page for more information.
* `-h`/`-?` - Displays a usage screen. The screen contains a list of command-line arguments and what each does.

If `-f` is not provided, a script argument is expected here.

Finally, one or more of the following parameters are consumed by **Jawk** and provided to the script via the ARGV/ARGC variables. The script can add/remove to this array to modify the behavior of the interpreter/compiled result.

* `<filename>` - Uses this file as input to the script. If the filename is invalid, an error is produced on stderr, but Jawk has no direct way of notifying the script.
* `<name=value>` - Performs this assignment as a global variable assignment prior to the consumption of the next input file.

If the parameter contains an `=`, **Jawk** treats it like a variable assignment. Otherwise, it's a filename.

> _**Note:** Parameters passed into the command-line which result in non-execution of the script (i.e., -S, -s, -h, -? and -z) cause **Jawk** to ignore filename and name=value parameters._

**Jawk** employs the org.jawk.util.AwkParameters for command-line parameter management. Please refer to the Javadocs for more details.

If an invalid command-line parameter is provided, **Jawk** will throw an IllegalArgumentException and terminate execution.

### Java Scripting API (JSR 223)

**Jawk** can be invoked via the JSR 223 scripting API (J2SE 6). The script API access mechanism was provided by Sun for previous versions of **Jawk** (0.14). To continue this support, **Jawk** implements a constructor similar to that used by previous versions.

## Features

As stated earlier, **Jawk** interprets AWK scripts in Java. This is a full implementation of AWK, which includes:

* An intuitive text processing paradigm, tightly integrated with regular expressions.
* Functions with local, static scoping.
* Scalar and associative array (map) variables.
* Weakly typed variables for greatest flexibility with automatic string/number conversion.
* Powerful IPC constructs similar to those used by most UNIX shells (pipes and IO redirect).
* Highly intuitive error diagnostics.

**Jawk** also offers the following features which the original AWK does not provide:

* Output to a post-compiled, pre-interpreted format for both elimination of the compilation step and obfuscation of **Jawk** scripts.
* Text dumps of abstract syntax tree and intermediate code representation (tuples).
* Maintenance of associative arrays in key-sorted order.
* Error detection for printf/sprintf format parameters (via the -r argument).
* An opt-in, flexible extension facility with event blocking capabilities.

Because we're using Java, the following differences exist in order to blend easily within the Java environment:

* **Jawk** regular expressions are implemented with Java regular expressions. Therefore, they differ from AWK's regular expression semantics (mostly by adding functionality over AWK's regular expressions).
* printf/sprintf formatting is done by java.util.Formatter. This is markedly different from C's, and thus AWK's printf(). Java's Formatter class does not attempt to implicitly convert its argument datatypes. If differing datatypes are present than what is expected, an IllegalFormatException will occur. Therefore, the script developer must either keep track of implicit type conversions by Jawk, or use \_DOUBLE, \_INTEGER, and _STRING keywords to forcibly convert parameters to these types (to do so, the -y parameter must be provided). An example is provided below:

    ```awk
    BEGIN {
        a=3
        # java.util.Formatter accepts %n as \\n
        printf("Integer of a = %02d%n", _INTEGER a)
        printf("Double of a = %.2f%n", _DOUBLE a)
        printf("String of a = %s%n", _STRING a)
    }
    ```

    Without the -y argument, only "String of a = 3" is displayed because `_STRING` is evaluated to a blank string, and the concatenation of two expressions results in a string. With the -y argument, all three lines are displayed.

### Differences with other AWKs

Other versions of AWK will run through a script and issue a "runtime error" if a user-defined function is not found. **Jawk** does not. It attempts to resolve all function calls to defined functions at _compile-time_ (after parsing the script and prior to assembling the intermediate code from the abstract syntax tree). This is necessary in order to produce intermediate code with branch statements fully resolved.

Other versions of AWK provide command-line parameters to choose compile-time or run-time checks for function name resolution. **Jawk** does not, mainly to ensure semantic analysis is done for the reasons stated above. Also, to undo these semantic checks will result in unresolved references, most likely resulting in NullPointerExceptions.

Other semantic checks include formal/actual parameter analysis and array/scalar operation verification. Again, these are necessary to produce coherent intermediate code.
